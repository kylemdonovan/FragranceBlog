{# app/templates/search_results.html #}
{% extends "base.html" %}

{% block content %}
    {# Display the search query #}
    <h1 class="mb-3">Search Results for: <span class="text-info">"{{ query }}"</span></h1>

    {# Check if any posts were found #}
    {% if posts %}
        {# Loop through posts found #}
        {% for post in posts %}
            <article class="media content-section">
              <div class="media-body">
                 {# Optional: Thumbnail #}
                 {% if post.image_url %}
                     {% set thumb_url = post.image_url.replace('/upload/', '/upload/w_150,h_100,c_fill,g_auto,f_auto,q_auto/') %}
                     <a href="{{ url_for('main.post', slug=post.slug) }}">
                         <img src="{{ thumb_url }}" alt="{{ post.title }} thumbnail" class="img-thumbnail float-end ms-3 mb-2" style="width: 150px;">
                     </a>
                 {% endif %}
                 {# End Thumbnail #}
                <div class="article-metadata">
                  <a class="mr-2" href="#">{{ post.author.username }}</a>
                  <small class="text-muted">{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }} UTC</small>
                </div>
                <h2><a class="article-title" href="{{ url_for('main.post', slug=post.slug) }}">{{ post.title }}</a></h2>
                {# Show snippet - consider highlighting search term later if desired #}
                <p class="article-content">{{ post.body | striptags | truncate(250, True) }}</p>
                 {# Optional: Display tags #}
                 <div class="post-tags mt-1">
                    {% for tag in post.tags %}
                         <a href="{{ url_for('main.tag', tag_name=tag.name) }}" class="badge bg-light text-dark text-decoration-none me-1">{{ tag.name }}</a>
                    {% endfor %}
                </div>
              </div>
            </article>
        {% endfor %}
    {% else %}
        {# Message if no posts matched #}
        <p>No posts found matching your search term "{{ query }}". Please try again.</p>
    {% endif %}

    {# Pagination Links specific to the search results view #}
    {# Check if pagination object exists before trying to access its properties #}
    {% if pagination %}
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center mt-4">
            {% if prev_url %}
              {# Ensure prev_url includes the query param 'q' (handled in routes.py) #}
              <li class="page-item"><a class="page-link" href="{{ prev_url }}">Previous</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}
            {# Display page numbers if desired #}
            {# Example: Basic page number display (more advanced logic possible) #}
            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
              {% if page_num %}
                {% if pagination.page == page_num %}
                  <li class="page-item active" aria-current="page">
                    <span class="page-link">{{ page_num }}</span>
                  </li>
                {% else %}
                  <li class="page-item"><a class="page-link" href="{{ url_for('main.search', q=query, page=page_num) }}">{{ page_num }}</a></li>
                {% endif %}
              {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
              {% endif %}
            {% endfor %}
            {# End Example Page Numbers #}
            {% if next_url %}
              {# Ensure next_url includes the query param 'q' (handled in routes.py) #}
              <li class="page-item"><a class="page-link" href="{{ next_url }}">Next</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
          </ul>
        </nav>
    {% endif %}
{% endblock %}